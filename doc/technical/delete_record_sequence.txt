User -> RecordController: DELETE /record/pid1,pid2,...

activate RecordController
note left of RecordController: Executing 'User Ophalen' returns u

alt u == null || !u.hasPermission("record:modify") 
RecordController --> User: 403: Forbidden
end 

loop for each pid in url
    note right of User
    On any DB error:
    Rollback and 
    return 500: Internal Server Error
    end note

note left of RecordController: Executing 'Record Ophalen' returns r
    

    
alt r != null
    RecordController -> RecordService: remove(r)
    deactivate RecordController

    activate RecordService
    RecordService -> RecordDAO: remove(r)
    deactivate RecordService

    activate RecordDAO
    RecordDAO --> RecordService:
    deactivate RecordDAO

    activate RecordService
    RecordService -> ContactDAO: remove(r.contact)
    deactivate RecordService

    activate ContactDAO
    ContactDAO --> RecordService:
    deactivate ContactDAO
    


    loop for each location in r.locations

        activate RecordService
        RecordService -> LocationDAO: remove(location)
        deactivate RecordService    

        activate LocationDAO
        LocationDAO --> RecordService:
        deactivate LocationDAO
    end

    loop for each reservation in r.reservations

        activate RecordService
        RecordService -> ReservationService: remove(reservation)
        deactivate RecordService    

        activate ReservationService
        ReservationService --> RecordService:
        deactivate ReservationService
    end

    loop for each pr in r.permissionRequests

        activate RecordService
        RecordService -> PermissionService: remove(pr)
        deactivate RecordService    

        activate PermissionService
        PermissionService --> RecordService:
        deactivate PermissionService
    end

    activate RecordService
    RecordService --> RecordController:
    deactivate RecordService


end

end

activate RecordController
RecordController --> User: 200: Ok
deactivate RecordController
