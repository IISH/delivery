<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright 2011 International Institute of Social History
  ~
  ~    Licensed under the Apache License, Version 2.0 (the "License");
  ~    you may not use this file except in compliance with the License.
  ~    You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~    Unless required by applicable law or agreed to in writing, software
  ~    distributed under the License is distributed on an "AS IS" BASIS,
  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~    See the License for the specific language governing permissions and
  ~    limitations under the License.
  -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:task="http://www.springframework.org/schema/task"
       xmlns:security="http://www.springframework.org/schema/security"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
    http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
    http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
    http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task.xsd
    http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.0.xsd">

  <!-- Imports user-defined @Controller beans that process client requests -->
  <tx:annotation-driven />
  <task:annotation-driven />
  <context:component-scan base-package="org.iisg" />
  <context:annotation-config />

  
 <!-- <mvc:annotation-driven />-->


  <mvc:resources mapping="/resources/**" location="/resources/" />

  <bean name="handlerMapping" id="handlerMapping" class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping">
    <property name="interceptors">
      <list>
       <ref bean="reqIntercept"/>
       <ref bean="secIntercept"/>
       <ref bean="locIntercept"/>
     </list>
    </property>
      <property name="urlPathHelper" ref="customUrlPathHelper" />
      <property name="order" value="1"/>
  </bean>

    <bean id="customUrlPathHelper" class="org.iisg.deliverance.UrlDecodedUrlPathHelper">
        <property name="urlDecode" value="false"/>
    </bean>
  <bean id="secIntercept" class="org.iisg.deliverance.user.controller.SecurityToViewInterceptor" />
  <bean id="locIntercept" class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor"/>
  <bean id="reqIntercept" class="org.iisg.deliverance.RequestContextToViewInterceptor" />

 <bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter">
    <property name="webBindingInitializer">
        <bean class="org.springframework.web.bind.support.ConfigurableWebBindingInitializer">
            <property name="validator" ref="validator2" />
            <property name="conversionService" ref="conversionService" />
        </bean>
    </property>
    <property name="messageConverters">
        <list>
           <bean class="org.springframework.http.converter.ByteArrayHttpMessageConverter" />
           <bean class="org.springframework.http.converter.StringHttpMessageConverter" />
           <bean class="org.springframework.http.converter.FormHttpMessageConverter" />
           <bean class="org.springframework.http.converter.xml.SourceHttpMessageConverter" />
        </list>
    </property>
     <property name="urlPathHelper" ref="customUrlPathHelper" />
 </bean>
 <bean id="conversionService" class="org.springframework.format.support.FormattingConversionServiceFactoryBean" />

    <!-- Do not remove this validator. It needs to be defined here or else
    the autowired dependencies of the validators won't be autowired. -->
  <bean id="validator2"
    class="org.springframework.validation.beanvalidation.LocalValidatorFactoryBean" />


  <!-- Utmost important this is defined below the component-scan,
  so defining this in security.xml won't work! -->
  <security:global-method-security secured-annotations="enabled"
                          jsr250-annotations="enabled" />

</beans>
